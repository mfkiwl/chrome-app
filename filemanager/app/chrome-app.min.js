!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):"object"==typeof exports?exports.ChromeAppManager=n():e.ChromeAppManager=n()}(this,function(){return function(e){function n(t){if(r[t])return r[t].exports;var o=r[t]={exports:{},id:t,loaded:!1};return e[t].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var r={};return n.m=e,n.c=r,n.p="",n(0)}([function(e,n,r){"use strict";var t=r(1);t.enable("*");var o=r(4);n.initConnection=function(e){var n=document.getElementById(e);if(!n)throw new Error("Element #"+e+" not found in the DOM");var t=new o(n);return t.register("fileSystem",r(5)),t}},function(e,n,r){function t(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+n.humanize(this.diff),!r)return e;var t="color: "+this.color;e=[e[0],t,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(s=o))}),e.splice(s,0,t),e}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function i(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(r){}}function a(){var e;try{e=n.storage.debug}catch(r){}return e}function c(){try{return window.localStorage}catch(e){}}n=e.exports=r(2),n.log=s,n.formatArgs=o,n.save=i,n.load=a,n.useColors=t,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},function(e,n,r){function t(){return n.colors[l++%n.colors.length]}function o(e){function r(){}function o(){var e=o,r=+new Date,s=r-(u||r);e.diff=s,e.prev=u,e.curr=r,u=r,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=t());var i=Array.prototype.slice.call(arguments);i[0]=n.coerce(i[0]),"string"!=typeof i[0]&&(i=["%o"].concat(i));var a=0;i[0]=i[0].replace(/%([a-z%])/g,function(r,t){if("%%"===r)return r;a++;var o=n.formatters[t];if("function"==typeof o){var s=i[a];r=o.call(e,s),i.splice(a,1),a--}return r}),"function"==typeof n.formatArgs&&(i=n.formatArgs.apply(e,i));var c=o.log||n.log||console.log.bind(console);c.apply(e,i)}r.enabled=!1,o.enabled=!0;var s=n.enabled(e)?o:r;return s.namespace=e,s}function s(e){n.save(e);for(var r=(e||"").split(/[\s,]+/),t=r.length,o=0;t>o;o++)r[o]&&(e=r[o].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function i(){n.enable("")}function a(e){var r,t;for(r=0,t=n.skips.length;t>r;r++)if(n.skips[r].test(e))return!1;for(r=0,t=n.names.length;t>r;r++)if(n.names[r].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}n=e.exports=o,n.coerce=c,n.disable=i,n.enable=s,n.enabled=a,n.humanize=r(3),n.names=[],n.skips=[],n.formatters={};var u,l=0},function(e,n){function r(e){if(e=""+e,!(e.length>1e4)){var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(n){var r=parseFloat(n[1]),t=(n[2]||"ms").toLowerCase();switch(t){case"years":case"year":case"yrs":case"yr":case"y":return r*l;case"days":case"day":case"d":return r*u;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}}function t(e){return e>=u?Math.round(e/u)+"d":e>=c?Math.round(e/c)+"h":e>=a?Math.round(e/a)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}function o(e){return s(e,u,"day")||s(e,c,"hour")||s(e,a,"minute")||s(e,i,"second")||e+" ms"}function s(e,n,r){return n>e?void 0:1.5*n>e?Math.floor(e/n)+" "+r:Math.ceil(e/n)+" "+r+"s"}var i=1e3,a=60*i,c=60*a,u=24*c,l=365.25*u;e.exports=function(e,n){return n=n||{},"string"==typeof e?r(e):n["long"]?o(e):t(e)}},function(e,n,r){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),s=r(1)("chrome-app"),i=new Map,a=0;window.addEventListener("message",function(e){var n=e.data;return n.windowID?n.type?i.has(n.windowID)?void i.get(n.windowID).handleMessage(n):s("window with id "+n.windowID+" not found",n):s("received a message without type",n):s("received a message without windowID",n)});var c=function(){function e(n){t(this,e),s("creating message handler"),this.window=null,this.windowID=++a,this.registeredHandlers=new Map,i.set(this.windowID,this);var r=this;n.addEventListener("contentload",function(){s("establish connection"),r.window=n.contentWindow,r.postMessage({type:"admin.connect",message:r.windowID})})}return o(e,[{key:"postMessage",value:function(e){s("post message",e),this.window.postMessage(e,"*")}},{key:"handleMessage",value:function(e){s("receive message",e);var n=e.type.split("."),r=n.shift();switch(r){case"admin":"connect"===n[0];break;case"test":e.status="warn",this.postMessage(e),e.message*=100,this.postMessage(e);var t=this;setTimeout(function(){e.status="success",e.message="hello",t.postMessage(e)},300);break;default:if(this.registeredHandlers.has(r))this.registeredHandlers.get(r).call(this,e,n);else{var o="no handler registered for type "+r;s(o),e.status="error",e.message=o,this.postMessage(e)}}}},{key:"register",value:function(e,n){this.registeredHandlers.set(e,n)}}]),e}();e.exports=c},function(e,n,r){"use strict";function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e){return d("select directory: "+e),f({type:"openDirectory"}).then(function(n){var r=chrome.fileSystem.retainEntry(n);return u(e,r)})}function s(e){return d("read directory: "+e),l(e).then(function(e){return new Promise(function(n,r){function t(){o.readEntries(function(e){0===e.length?n(s):(s=s.concat(e.map(function(e){return{name:e.name,isFile:e.isFile,isDirectory:e.isDirectory}})),t())},r)}var o=e.createReader(),s=[];t()})})}function i(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],t=r.encoding,o=void 0===t?"text":t;return d("read file: "+e+" ("+n+")"),l(e).then(function(e){return new Promise(function(r,t){e.getFile(n,{create:!1},function(e){e.file(function(e){var n=new FileReader;n.onload=function(){r(n.result)},n.onerror=function(){t(n.error)},"text"===o?n.readAsText(e):"base64"===o?n.readAsDataURL(e):"buffer"===o?n.readAsArrayBuffer(e):"binary"===o?n.readAsBinaryString(e):t("Unknown encoding: "+o)},t)},t)})})}function a(e,n,r){var t=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=t.encoding,s=void 0===o?"text":o,i=t.exclusive,a=void 0===i?!1:i,u=t.type,f=void 0===u?"text/plain":u;return d("write file: "+e+" ("+n+")"),l(e).then(function(e){return new Promise(function(t,o){e.getFile(n,{create:!0,exclusive:a},function(e){e.createWriter(function(e){e.onwriteend=function(){0===e.length?e.write(c(r,s,f)):t(!0)},e.onerror=o,e.truncate(0)},o)},o)})})}function c(e,n,r){if("text"===n)return new Blob([e],{type:r});if("base64"===n){for(var t=e.split(";base64,"),o=t[0].split(":")[1],s=atob(t[1]),i=new Uint8Array(s.length),a=0;a<s.length;a++)i[a]=s.charCodeAt(a);return new Blob([i],{type:o})}if("buffer"===n){var i=new Uint8Array(e);return new Blob([i],{type:r})}}function u(e,n){return g.get(h).then(function(r){return r?r[e]=n:r=t({},e,n),g.set(h,r)})}function l(e){return g.get(h).then(function(n){return n&&n[e]?n[e]:o(e)}).then(m)}function f(e){return new Promise(function(n,r){chrome.fileSystem.chooseEntry(e,function(e){chrome.runtime.lastError?r(chrome.runtime.lastError):n(e)})})}function m(e){return new Promise(function(n,r){chrome.fileSystem.restoreEntry(e,function(e){chrome.runtime.lastError?r(chrome.runtime.lastError):n(e)})})}var d=r(1)("fileSystem"),g=r(6),h="fileSystem.directories";e.exports=function(e,n){d("fs call");var r=e.message;if(!r||"string"!=typeof r.label)return e.status="error",e.message="fileSystem actions need a label",this.postMessage(e);var t=void 0;switch(n[0]){case"selectDirectory":t=o(r.label);break;case"readDirectory":t=s(r.label);break;case"readFile":t=i(r.label,r.name,r.options);break;case"writeFile":t=a(r.label,r.name,r.data,r.options);break;default:t=Promise.reject("Unknown fileSystem action: "+n[0])}var c=this;t.then(function(n){e.status="success",e.message=n,c.postMessage(e)},function(n){e.status="error",e.message=n,c.postMessage(e)})}},function(e,n){"use strict";function r(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var t=chrome.storage.local;n.get=function(e){return new Promise(function(n,r){t.get(e,function(t){chrome.runtime.lastError?r(chrome.runtime.lastError):n(t[e])})})},n.set=function(e,n){return new Promise(function(o,s){t.set(r({},e,n),function(){chrome.runtime.lastError?s(chrome.runtime.lastError):o(!0)})})},n.remove=function(e){return new Promise(function(n,r){t.remove(e,function(){chrome.runtime.lastError?r(chrome.runtime.lastError):n(!0)})})},n.clear=function(){return new Promise(function(e,n){t.clear(function(){chrome.runtime.lastError?n(chrome.runtime.lastError):e(!0)})})}}])});
//# sourceMappingURL=chrome-app.min.js.map