!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):"object"==typeof exports?exports.ChromeAppManager=n():e.ChromeAppManager=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";var r=t(1);window.DebugNS&&r.enable(window.DebugNS);var o=t(4);n.initConnection=function(e){var n=document.getElementById(e);if(!n)throw new Error("Element #"+e+" not found in the DOM");var r=new o(n);return r.register("fileSystem",t(5)),r}},function(e,n,t){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(s=o))}),e.splice(s,0,r),e}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function i(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(t){}}function a(){var e;try{e=n.storage.debug}catch(t){}return e}function c(){try{return window.localStorage}catch(e){}}n=e.exports=t(2),n.log=s,n.formatArgs=o,n.save=i,n.load=a,n.useColors=r,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},function(e,n,t){function r(){return n.colors[l++%n.colors.length]}function o(e){function t(){}function o(){var e=o,t=+new Date,s=t-(u||t);e.diff=s,e.prev=u,e.curr=t,u=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=r());var i=Array.prototype.slice.call(arguments);i[0]=n.coerce(i[0]),"string"!=typeof i[0]&&(i=["%o"].concat(i));var a=0;i[0]=i[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;a++;var o=n.formatters[r];if("function"==typeof o){var s=i[a];t=o.call(e,s),i.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(i=n.formatArgs.apply(e,i));var c=o.log||n.log||console.log.bind(console);c.apply(e,i)}t.enabled=!1,o.enabled=!0;var s=n.enabled(e)?o:t;return s.namespace=e,s}function s(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,o=0;r>o;o++)t[o]&&(e=t[o].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function i(){n.enable("")}function a(e){var t,r;for(t=0,r=n.skips.length;r>t;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;r>t;t++)if(n.names[t].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}n=e.exports=o,n.coerce=c,n.disable=i,n.enable=s,n.enabled=a,n.humanize=t(3),n.names=[],n.skips=[],n.formatters={};var u,l=0},function(e,n){function t(e){if(e=""+e,!(e.length>1e4)){var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(n){var t=parseFloat(n[1]),r=(n[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*l;case"days":case"day":case"d":return t*u;case"hours":case"hour":case"hrs":case"hr":case"h":return t*c;case"minutes":case"minute":case"mins":case"min":case"m":return t*a;case"seconds":case"second":case"secs":case"sec":case"s":return t*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}}function r(e){return e>=u?Math.round(e/u)+"d":e>=c?Math.round(e/c)+"h":e>=a?Math.round(e/a)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}function o(e){return s(e,u,"day")||s(e,c,"hour")||s(e,a,"minute")||s(e,i,"second")||e+" ms"}function s(e,n,t){return n>e?void 0:1.5*n>e?Math.floor(e/n)+" "+t:Math.ceil(e/n)+" "+t+"s"}var i=1e3,a=60*i,c=60*a,u=24*c,l=365.25*u;e.exports=function(e,n){return n=n||{},"string"==typeof e?t(e):n["long"]?o(e):r(e)}},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),s=t(1)("chrome-app"),i=new Map,a=0;window.addEventListener("message",function(e){var n=e.data;return n.windowID?n.type?i.has(n.windowID)?void i.get(n.windowID).handleMessage(n):s("window with id "+n.windowID+" not found",n):s("received a message without type",n):s("received a message without windowID",n)});var c=function(){function e(n){var t=this;r(this,e),s("creating message handler"),this.window=null,this.windowID=++a,this.registeredHandlers=new Map,i.set(this.windowID,this),n.addEventListener("contentload",function(){t.disconnect(),s("establish connection"),t.window=n.contentWindow,t.connect()})}return o(e,[{key:"connect",value:function(){var e=this;s("connect"),this.postMessage({type:"admin.connect",message:this.windowID}),this.connectionInterval=setInterval(function(){e.postMessage({type:"admin.connect",message:e.windowID})},500)}},{key:"disconnect",value:function(){this.clearConnectionInterval()}},{key:"clearConnectionInterval",value:function(){this.connectionInterval&&(clearInterval(this.connectionInterval),this.connectionInterval=null)}},{key:"postMessage",value:function(e){this.window.postMessage(e,"*")}},{key:"handleMessage",value:function(e){var n=this;s("receive message",e);var t=e.type.split("."),r=t.shift();switch(r){case"admin":"connect"===t[0]&&this.clearConnectionInterval();break;case"test":e.status="warn",this.postMessage(e),e.message*=100,this.postMessage(e),setTimeout(function(){e.status="success",e.message="hello",n.postMessage(e)},300);break;default:if(this.registeredHandlers.has(r))this.registeredHandlers.get(r).call(this,e,t);else{var o="no handler registered for type "+r;s(o),e.status="error",e.message=o,this.postMessage(e)}}}},{key:"register",value:function(e,n){this.registeredHandlers.set(e,n)}}]),e}();e.exports=c},function(e,n,t){"use strict";function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e){return m("select directory: "+e),f({type:"openDirectory"}).then(function(n){var t=chrome.fileSystem.retainEntry(n);return u(e,t)})}function s(e){return m("read directory: "+e),l(e).then(function(e){return new Promise(function(n,t){function r(){o.readEntries(function(e){0===e.length?n(s):(s=s.concat(e.map(function(e){return{name:e.name,isFile:e.isFile,isDirectory:e.isDirectory}})),r())},t)}var o=e.createReader(),s=[];r()})})}function i(e,n){var t=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=t.encoding,o=void 0===r?"text":r;return m("read file: "+e+" ("+n+")"),l(e).then(function(e){return new Promise(function(t,r){e.getFile(n,{create:!1},function(e){e.file(function(e){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=function(){r(n.error)},"text"===o?n.readAsText(e):"base64"===o?n.readAsDataURL(e):"buffer"===o?n.readAsArrayBuffer(e):"binary"===o?n.readAsBinaryString(e):r("Unknown encoding: "+o)},r)},r)})})}function a(e,n,t){var r=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=r.encoding,s=void 0===o?"text":o,i=r.exclusive,a=void 0===i?!1:i,u=r.type,f=void 0===u?"text/plain":u;return m("write file: "+e+" ("+n+")"),l(e).then(function(e){return new Promise(function(r,o){e.getFile(n,{create:!0,exclusive:a},function(e){e.createWriter(function(e){e.onwriteend=function(){0===e.length?e.write(c(t,s,f)):r(!0)},e.onerror=o,e.truncate(0)},o)},o)})})}function c(e,n,t){if("text"===n)return new Blob([e],{type:t});if("base64"===n){for(var r=e.split(";base64,"),o=r[0].split(":")[1],s=atob(r[1]),i=new Uint8Array(s.length),a=0;a<s.length;a++)i[a]=s.charCodeAt(a);return new Blob([i],{type:o})}if("buffer"===n){var i=new Uint8Array(e);return new Blob([i],{type:t})}}function u(e,n){return h.get(g).then(function(t){return t?t[e]=n:t=r({},e,n),h.set(g,t)})}function l(e){return h.get(g).then(function(n){return n&&n[e]?n[e]:o(e)}).then(d)}function f(e){return new Promise(function(n,t){chrome.fileSystem.chooseEntry(e,function(e){chrome.runtime.lastError?t(chrome.runtime.lastError):n(e)})})}function d(e){return new Promise(function(n,t){chrome.fileSystem.restoreEntry(e,function(e){chrome.runtime.lastError?t(chrome.runtime.lastError):n(e)})})}var m=t(1)("fileSystem"),h=t(6),g="fileSystem.directories";e.exports=function(e,n){var t=this;m("fs call");var r=e.message;if(!r||"string"!=typeof r.label)return e.status="error",e.message="fileSystem actions need a label",this.postMessage(e);var c=void 0;switch(n[0]){case"selectDirectory":c=o(r.label);break;case"readDirectory":c=s(r.label);break;case"readFile":c=i(r.label,r.name,r);break;case"writeFile":c=a(r.label,r.name,r.data,r);break;default:c=Promise.reject("Unknown fileSystem action: "+n[0])}c.then(function(n){e.status="success",e.message=n,t.postMessage(e)},function(n){e.status="error",e.message=n,t.postMessage(e)})}},function(e,n){"use strict";function t(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var r=chrome.storage.local;n.get=function(e){return new Promise(function(n,t){r.get(e,function(r){chrome.runtime.lastError?t(chrome.runtime.lastError):n(r[e])})})},n.set=function(e,n){return new Promise(function(o,s){r.set(t({},e,n),function(){chrome.runtime.lastError?s(chrome.runtime.lastError):o(!0)})})},n.remove=function(e){return new Promise(function(n,t){r.remove(e,function(){chrome.runtime.lastError?t(chrome.runtime.lastError):n(!0)})})},n.clear=function(){return new Promise(function(e,n){r.clear(function(){chrome.runtime.lastError?n(chrome.runtime.lastError):e(!0)})})}}])});
//# sourceMappingURL=chrome-app.min.js.map